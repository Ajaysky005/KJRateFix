<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KJRateFix - Entry</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }

        .btn {
            margin-top: 20px;
        }

        .dynamic-fields {
            margin-top: 20px;
        }

        .calculate-btn {
            margin-top: 10px;
        }
    </style>
</head>

<body>
      <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="#">KJRateFix</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="entry.html">Entry</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="viewdata.html">View Data</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="accandcovered.html">Covered</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

    <div class="container">
        <h2 class="text-center">Enter Order</h2>
        <form id="entryForm">
            <div class="mb-3">
                <label for="name" class="form-label">Customer Name</label>
                <input type="text" class="form-control" id="name" required>
            </div>

            <div>
                <button type="button" class="btn btn-primary" id="btnWeight">Weight</button>
                <button type="button" class="btn btn-primary" id="btnAmount">Amount</button>
            </div>

            <!-- Dynamic fields for Weight/Rate or Rate/Amount will appear here -->
            <div id="dynamicFields" class="dynamic-fields"></div>

            <button type="button" class="btn btn-success" id="btnSave">Save</button>
        </form>
    </div>

    <script type="module">
        // Import Firebase using CDN
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyAFr9vK3MbujpR9KFe_UsKHHCtedsYj26A",
          authDomain: "kjratefixweb.firebaseapp.com",
          databaseURL: "https://kjratefixweb-default-rtdb.firebaseio.com",
          projectId: "kjratefixweb",
          storageBucket: "kjratefixweb.firebasestorage.app",
          messagingSenderId: "854761320925",
          appId: "1:854761320925:web:1a48cc618d83f7e4b34634"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Elements
        const dynamicFields = document.getElementById('dynamicFields');
        const btnWeight = document.getElementById('btnWeight');
        const btnAmount = document.getElementById('btnAmount');
        const btnSave = document.getElementById('btnSave');

        let etWeight, etRate, etAmount, calculateBtn;

        // Button event listeners
        btnWeight.addEventListener('click', showWeightFields);
        btnAmount.addEventListener('click', showAmountFields);

        // Weight and Rate input fields
        function showWeightFields() {
            dynamicFields.innerHTML = '';

            etWeight = createInputField('Weight');
            etRate = createInputField('Rate');
            etAmount = createInputField('Amount', true); // Amount field is disabled (calculated)

            dynamicFields.appendChild(etWeight);
            dynamicFields.appendChild(etRate);
            dynamicFields.appendChild(etAmount);

            calculateBtn = createButton('Calculate', calculateValues);
            dynamicFields.appendChild(calculateBtn);
        }

        // Rate and Amount input fields
        function showAmountFields() {
            dynamicFields.innerHTML = '';

            etRate = createInputField('Rate');
            etAmount = createInputField('Amount');
            etWeight = createInputField('Weight', true); // Weight field is disabled (calculated)

            dynamicFields.appendChild(etRate);
            dynamicFields.appendChild(etAmount);
            dynamicFields.appendChild(etWeight);

            calculateBtn = createButton('Calculate', calculateValues);
            dynamicFields.appendChild(calculateBtn);
        }

        function createInputField(label, disabled = false) {
            const div = document.createElement('div');
            div.className = 'mb-3';
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'form-control';
            input.placeholder = label;
            input.disabled = disabled;
            div.appendChild(input);
            return div;
        }

        function createButton(label, onClick) {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'btn btn-info calculate-btn';
            button.textContent = label;
            button.addEventListener('click', onClick);
            return button;
        }

        function calculateValues() {
            const rate = parseFloat(etRate.querySelector('input').value) || 0;
            const weight = parseFloat(etWeight.querySelector('input').value) || 0;
            const amount = parseFloat(etAmount.querySelector('input').value) || 0;

            if (etAmount.querySelector('input').disabled && weight && rate) {
                etAmount.querySelector('input').value = (weight * rate).toFixed(2);
                etAmount.querySelector('input').disabled = true;
            } else if (etWeight.querySelector('input').disabled && amount && rate) {
                etWeight.querySelector('input').value = (amount / rate).toFixed(2);
                etWeight.querySelector('input').disabled = true;
            }
        }

        btnSave.addEventListener('click', function () {
            const name = document.getElementById('name').value;
            const weight = etWeight.querySelector('input').value;
            const rate = etRate.querySelector('input').value;
            const amount = etAmount.querySelector('input').value;

            if (!name || !weight || !rate || !amount) {
                alert("Please fill all fields before saving.");
                return;
            }

            addDoc(collection(db, "orders"), {
                name: name,
                weight: parseFloat(weight),
                rate: parseFloat(rate),
                amount: parseFloat(amount),
                timestamp: serverTimestamp()
            })
            .then(() => {
                alert('Data saved successfully!');
            })
            .catch((error) => {
                console.error("Error adding document: ", error);
            });
        });
    </script>
</body>

</html>
